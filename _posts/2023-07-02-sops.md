---
title: "Securing Your Secrets: A Guide to Encrypting and Storing Them on Git with Sops"
published: true
---

---
layout: post
title: "Securing Your Secrets: A Guide to Encrypting and Storing Them on Git with Sops"
date: 2023-07-02
author: David Paulus
categories: [Security, Git, Encryption]
---

If you're working on a project that requires storing sensitive data, such as passwords or API keys, you need to make sure that this information is kept secure. One way to do this is to use a tool called Sops to encrypt your secrets and store them on Git. In this guide, we'll walk through the steps you need to take to implement this security measure.

## What is Sops?

Sops is a tool that allows you to encrypt files using various encryption algorithms. It's designed to be used with Git, so you can store the encrypted files in your repository and still keep them secure. Sops supports a variety of encryption algorithms, including AES-256 and RSA, and it integrates with various key management systems, such as AWS KMS and Google Cloud KMS.

## Installing Sops

Before we can start using Sops, we need to install it. Sops is available for Linux, macOS, and Windows. You can find installation instructions for your specific operating system on the Sops GitHub page.

## Creating an Encryption Key

The first step in using Sops is to create an encryption key. This key will be used to encrypt and decrypt your secrets. To create an encryption key, run the following command:

```
sops --generate-encryption-key > mykey.yaml
```

This will create a new YAML file called `mykey.yaml` that contains your encryption key. Make sure to store this key in a secure location, such as a password manager or a secure file storage service like AWS S3 or Google Cloud Storage.

## Encrypting Your Secrets

Now that we have an encryption key, we can use Sops to encrypt our secrets. To do this, create a new YAML file that contains your secrets. For example:

```yaml
password: mysecretpassword
api_key: mysecretapikey
```

Save this file as `secrets.yaml`. Then, encrypt the file using the following command:

```
sops --encrypt --pgp <your-key-id> secrets.yaml > secrets.enc.yaml
```

Replace `<your-key-id>` with the ID of the PGP key you want to use for encryption. This will create a new encrypted YAML file called `secrets.enc.yaml`.

## Adding Encrypted Secrets to Git

Now that we have our encrypted secrets file, we can add it to Git. However, before we do so, we need to make sure that we're not adding any sensitive information to our Git history. To do this, we'll use Git's `filter-branch` command.

First, create a file called `clean.sh` with the following contents:

```bash
#!/bin/sh

# Remove secrets file
rm -f secrets.yaml

# Remove encrypted secrets file
rm -f secrets.enc.yaml

# Remove Sops key file
rm -f mykey.yaml
```

This script will remove all sensitive files before they get committed to Git. Make sure to add this script to your `.gitignore` file so that it's not committed to Git itself.

Next, run the following command to filter out any sensitive information from your Git history:

```
git filter-branch --force --index-filter \
"git rm --cached --ignore-unmatch secrets.yaml secrets.enc.yaml mykey.yaml" \
--prune-empty --tag-name-filter cat -- --all
```

This command will remove all instances of the `secrets.yaml`, `secrets.enc.yaml`, and `mykey.yaml` files from your Git history.

Now, you can add your encrypted secrets file to Git:

```
git add secrets.enc.yaml
git commit -m "Add encrypted secrets file"
```

## Decrypting Your Secrets

To decrypt your secrets, run the following command:

```
sops --decrypt secrets.enc.yaml > secrets.yaml
```

This will create a new file called `secrets.yaml` that contains your decrypted secrets.

## Conclusion

Using Sops to encrypt your secrets and store them on Git is an effective way to keep your sensitive information secure. By following the steps in this guide, you can ensure that your project's secrets are protected from prying eyes while still being easily accessible to authorized users.